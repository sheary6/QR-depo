<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>License QR Generator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f6f7f9;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
    }
    .container {
      background: #fff;
      padding: 20px 30px;
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
      width: 520px;
      max-width: 95vw;
    }
    h2 {
      margin-top: 0;
      font-size: 20px;
      text-align: center;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 12px;
    }
    input, textarea {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
    }
    textarea { resize: vertical; min-height: 60px; }
    button {
      margin-top: 16px;
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      background: #111827;
      color: #fff;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover { background: #374151; }
    .qr-output { margin-top: 20px; }
    .qr-block { margin-top: 18px; text-align: center; }
    .qr-block h3 { margin-bottom: 8px; }
    .qr-block img {
      margin-top: 6px;
      width: 220px;
      height: 220px;
      image-rendering: pixelated;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>License QR Code Generator</h2>
    <form id="qrForm">
      <label>License Account No.:</label>
      <input type="text" id="accountNo" value="L2540000675570">

      <label>Application No.:</label>
      <input type="text" id="applicationNo" value="EL2540000687612">

      <label>Business Name:</label>
      <input type="text" id="businessName" value="KOPI KENANGAN SDN BHD">

      <label>Premises Address:</label>
      <textarea id="address">UNIT 1302, LEVEL 13, UPTOWN 2,
NO. 2 JALAN SS21/37,
DAMANSARA UPTOWN,
47400 PETALING JAYA</textarea>

      <label>Start Date:</label>
      <input type="text" id="startDate" value="01 January, 2025">

      <label>End Date:</label>
      <input type="text" id="endDate" value="31 December, 2025">

      <label>Status:</label>
      <input type="text" id="status" value="APPROVED">

      <button type="button" onclick="generateQR()">Generate QR Codes</button>
    </form>

    <div class="qr-output">
      <div class="qr-block">
        <h3>ðŸ“„ Full Info QR (Dense)</h3>
        <div id="fullInfoQR"></div>
      </div>
      <div class="qr-block">
        <h3>ðŸ”— Short Link QR (Clean)</h3>
        <div id="shortLinkQR"></div>
        <button type="button" id="downloadShortBtn" disabled>Download Short Link QR (PNG)</button>
      </div>
    </div>
  </div>

  <!-- QRCode.js library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script>
    let shortLinkCanvas = null;
    let lastShortLink = "";

    function generateQR() {
      const accountNo = document.getElementById("accountNo").value;
      const applicationNo = document.getElementById("applicationNo").value;
      const businessName = document.getElementById("businessName").value;
      const address = document.getElementById("address").value;
      const startDate = document.getElementById("startDate").value;
      const endDate = document.getElementById("endDate").value;
      const status = document.getElementById("status").value;

      // Full info block
      const fullData = 
        "License Account No. : " + accountNo + "\n\n" +
        "Application No. : " + applicationNo + "\n\n" +
        "Business Name : " + businessName + "\n\n" +
        "Premises Address : " + address + "\n\n" +
        "Start Date : " + startDate + "\n" +
        "End Date : " + endDate + "\n" +
        "Status : " + status;

      // Short link (example domain)
      const shortLink = "https://qr-depo.vercel.app/?id=" + accountNo;
      lastShortLink = shortLink;

      // Clear previous
      document.getElementById("fullInfoQR").innerHTML = "";
      document.getElementById("shortLinkQR").innerHTML = "";

      // Generate Full Info QR
      new QRCode(document.getElementById("fullInfoQR"), {
        text: fullData,
        width: 220,
        height: 220,
        colorDark: "#000000",
        colorLight: "#ffffff",
        correctLevel: QRCode.CorrectLevel.L
      });

      // Generate Short Link QR
      const shortContainer = document.getElementById("shortLinkQR");
      const shortInstance = new QRCode(shortContainer, {
        text: shortLink,
        width: 220,
        height: 220,
        colorDark: "#000000",
        colorLight: "#ffffff",
        correctLevel: QRCode.CorrectLevel.H
      });

      // Enable download once the canvas is available
      // qrcodejs renders an <img> or <canvas>; force canvas for better PNG
      setTimeout(function() {
        const img = shortContainer.querySelector('img');
        if (img) {
          // Replace image with canvas to allow toDataURL
          const tempQR = new QRCode(document.createElement('div'), {
            text: shortLink,
            width: 220,
            height: 220,
            colorDark: "#000000",
            colorLight: "#ffffff",
            correctLevel: QRCode.CorrectLevel.H
          });
          setTimeout(function() {
            const cvs = tempQR._oDrawing._elCanvas;
            if (cvs) {
              shortContainer.innerHTML = "";
              shortContainer.appendChild(cvs);
              shortLinkCanvas = cvs;
              document.getElementById('downloadShortBtn').disabled = false;
            }
          }, 0);
        } else {
          const cvs = shortContainer.querySelector('canvas');
          if (cvs) {
            shortLinkCanvas = cvs;
            document.getElementById('downloadShortBtn').disabled = false;
          }
        }
      }, 0);
    }

    // Download handler for Short Link QR
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('downloadShortBtn').addEventListener('click', function() {
        // Generate a high-res (1024x1024) QR in a temporary container for sharp export
        const temp = document.createElement('div');
        temp.style.position = 'fixed';
        temp.style.left = '-9999px';
        document.body.appendChild(temp);
        const tempQR = new QRCode(temp, {
          text: lastShortLink || 'about:blank',
          width: 1024,
          height: 1024,
          colorDark: '#000000',
          colorLight: '#ffffff',
          correctLevel: QRCode.CorrectLevel.H
        });
        setTimeout(function() {
          const cvs = tempQR._oDrawing && tempQR._oDrawing._elCanvas;
          const href = cvs ? cvs.toDataURL('image/png') : temp.querySelector('img')?.src;
          if (href) {
            const link = document.createElement('a');
            link.download = 'short-link-qr-1024.png';
            link.href = href;
            link.click();
          }
          document.body.removeChild(temp);
        }, 0);
      });
    });
  </script>
</body>
</html>
